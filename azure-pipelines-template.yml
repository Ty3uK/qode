steps:
- task: NodeTool@0
  inputs:
    versionSpec: 10.x

- task: UsePythonVersion@0
  inputs:
    versionSpec: '2.7'
    architecture: 'x64'

- script: node build.js $(TARGET_ARCH)
  timeoutInMinutes: 120
  displayName: Build

- script: out/Release/yode test.js
  displayName: Test

- task: GithubRelease@0
  displayName: Create GitHub Release
  condition: startsWith(variables['Release.Tag'], 'v')
  inputs:
    gitHubConnection: GitHub Yue
    repositoryName: yue/yode
    action: edit
    tagSource: auto
    tag: $(Release.Tag)
    title: Yode $(Release.Tag)
    releaseNotes: (placeholder)
    assets: 'out/Release/*.zip'
    assetUploadMode: replace
    isDraft: true
